<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Daniel J. Hicks">
<meta name="dcterms.date" content="2023-05-02">

<title>tmfast fits topic models fast</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="paper_files/libs/clipboard/clipboard.min.js"></script>
<script src="paper_files/libs/quarto-html/quarto.js"></script>
<script src="paper_files/libs/quarto-html/popper.min.js"></script>
<script src="paper_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="paper_files/libs/quarto-html/anchor.min.js"></script>
<link href="paper_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="paper_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="paper_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="paper_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="paper_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="toc-section-number">1</span>  Introduction</a></li>
  <li><a href="#sec-math" id="toc-sec-math" class="nav-link" data-scroll-target="#sec-math"><span class="toc-section-number">2</span>  Mathematical background</a></li>
  <li><a href="#sec-sim" id="toc-sec-sim" class="nav-link" data-scroll-target="#sec-sim"><span class="toc-section-number">3</span>  Example 1: A simulated corpus</a>
  <ul class="collapse">
  <li><a href="#simulation-parameters" id="toc-simulation-parameters" class="nav-link" data-scroll-target="#simulation-parameters"><span class="toc-section-number">3.1</span>  Simulation parameters</a></li>
  <li><a href="#draw-true-topic-distributions" id="toc-draw-true-topic-distributions" class="nav-link" data-scroll-target="#draw-true-topic-distributions"><span class="toc-section-number">3.2</span>  Draw true topic distributions</a></li>
  <li><a href="#draw-true-word-distributions" id="toc-draw-true-word-distributions" class="nav-link" data-scroll-target="#draw-true-word-distributions"><span class="toc-section-number">3.3</span>  Draw true word distributions</a></li>
  <li><a href="#document-lengths" id="toc-document-lengths" class="nav-link" data-scroll-target="#document-lengths"><span class="toc-section-number">3.4</span>  Document lengths</a></li>
  <li><a href="#draw-corpus" id="toc-draw-corpus" class="nav-link" data-scroll-target="#draw-corpus"><span class="toc-section-number">3.5</span>  Draw corpus</a></li>
  <li><a href="#fit-the-topic-model" id="toc-fit-the-topic-model" class="nav-link" data-scroll-target="#fit-the-topic-model"><span class="toc-section-number">3.6</span>  Fit the topic model</a></li>
  <li><a href="#fitting-a-conventional-topic-model-stm" id="toc-fitting-a-conventional-topic-model-stm" class="nav-link" data-scroll-target="#fitting-a-conventional-topic-model-stm"><span class="toc-section-number">3.7</span>  Fitting a conventional topic model (stm)</a></li>
  <li><a href="#assessing-accuracy-word-topic-distributions" id="toc-assessing-accuracy-word-topic-distributions" class="nav-link" data-scroll-target="#assessing-accuracy-word-topic-distributions"><span class="toc-section-number">3.8</span>  Assessing accuracy: Word-topic distributions</a></li>
  <li><a href="#renormalization-topic-document-distributions" id="toc-renormalization-topic-document-distributions" class="nav-link" data-scroll-target="#renormalization-topic-document-distributions"><span class="toc-section-number">3.9</span>  Renormalization: Topic-document distributions</a></li>
  </ul></li>
  <li><a href="#sec-realbooks" id="toc-sec-realbooks" class="nav-link" data-scroll-target="#sec-realbooks"><span class="toc-section-number">4</span>  Example 2: Literature from the long nineteenth century</a>
  <ul class="collapse">
  <li><a href="#corpus-assembly" id="toc-corpus-assembly" class="nav-link" data-scroll-target="#corpus-assembly"><span class="toc-section-number">4.1</span>  Corpus assembly</a></li>
  <li><a href="#vocabulary-selection" id="toc-vocabulary-selection" class="nav-link" data-scroll-target="#vocabulary-selection"><span class="toc-section-number">4.2</span>  Vocabulary selection</a></li>
  <li><a href="#fit-topic-models" id="toc-fit-topic-models" class="nav-link" data-scroll-target="#fit-topic-models"><span class="toc-section-number">4.3</span>  Fit topic models</a></li>
  <li><a href="#topic-exploration" id="toc-topic-exploration" class="nav-link" data-scroll-target="#topic-exploration"><span class="toc-section-number">4.4</span>  Topic exploration</a></li>
  </ul></li>
  <li><a href="#reproducibility" id="toc-reproducibility" class="nav-link" data-scroll-target="#reproducibility"><span class="toc-section-number">5</span>  Reproducibility</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="toc-section-number">6</span>  References</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><code>tmfast</code> fits topic models fast</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    Daniel J. Hicks <a href="https://orcid.org/0000-0001-7945-4416" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            University of California, Merced
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">2023-05-02</p>
    </div>
  </div>
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="abstract-title">Abstract</div>
    <code>tmfast</code> is an R package for fitting topic models using a fast algorithm based on partial PCA and the varimax rotation. After providing mathematical background to the method, we present two examples, using a simulated corpus and aggregated works of a selection of authors from the long nineteenth century, and compare the quality of the fitted models to a standard topic modeling package.
  </div>
</div>

</header>

<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>Topic modeling is a natural language processing (NLP) technique popular among digital humanists, computational social scientists, and data scientists working with textual data (eg, product reviews) <span class="citation" data-cites="RobertsStmPackageStructural2019">(<a href="#ref-RobertsStmPackageStructural2019" role="doc-biblioref">Roberts, Stewart, and Tingley 2019</a>)</span>. Compared to methods such as vector space embeddings or general-use clustering algorithms such as <span class="math inline">\(k\)</span>-means, a key advantage of topic modeling is that it simultaneously clusters both text units (terms or phrases) and documents, enabling analysts to provide human-meaningful, domain-specific labels to the clusters (topics).</p>
<p>However, a major disadvantage of topic modeling is that the models are relatively computationally intensive and slow to fit. This strongly discourages analysts from fitting and comparing multiple models, which is arguably the best way to determine to what extent results are sensitive to researcher degrees of freedom <span class="citation" data-cites="GelmanGardenForkingPaths2013 SteegenIncreasingTransparencyMultiverse2016">(<a href="#ref-GelmanGardenForkingPaths2013" role="doc-biblioref">Gelman and Loken 2013</a>; <a href="#ref-SteegenIncreasingTransparencyMultiverse2016" role="doc-biblioref">Steegen et al. 2016</a>)</span>. Instead, typically analysts fit a few models to a given corpus and focus interpretation on a single “best” model, often chosen by informal assessments of “interpretability” of the fitted topics, introducing additional researcher degrees of freedom.</p>
<p>This paper reports <code>tmfast</code>, an R package designed to facilitate a multiple-model approach by using a significantly faster fitting algorithm. After giving a brief mathematical background in <a href="#sec-math">Section&nbsp;2</a>, we walk through two examples of <code>tmfast</code> in action: generating and fitting models to a simulated text corpus (<a href="#sec-sim">Section&nbsp;3</a>), and then fitting models to a collection of books by different authors retrieved from Project Gutenberg (<a href="#sec-realbooks">Section&nbsp;4</a>). Note that both of these examples are supervised cases — the true topics are known <em>a priori</em> — and we use a method from <span class="citation" data-cites="MalaterreEarlyDaysContemporary2022">Malaterre and Lareau (<a href="#ref-MalaterreEarlyDaysContemporary2022" role="doc-biblioref">2022</a>)</span> to assess goodness of fit. In addition, we also fit models using the <code>stm</code> package <span class="citation" data-cites="RobertsStmPackageStructural2019">(<a href="#ref-RobertsStmPackageStructural2019" role="doc-biblioref">Roberts, Stewart, and Tingley 2019</a>)</span> — generally regarded as the state of the art in topic modelling in R — and compare the models fitted by the two packages. <code>tmfast</code> is available at <code>&lt;https://github.com/dhicks/tmfast&gt;</code>.</p>
</section>
<section id="sec-math" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Mathematical background</h1>
<p>Topic modeling is typically framed using a generative model. A corpus <span class="math inline">\(C\)</span> is defined by a fixed vocabulary or collection of terms <span class="math inline">\(T\)</span>; a collection of <span class="math inline">\(k\)</span> topics <span class="math inline">\(B\)</span>, where each topic <span class="math inline">\(\beta \in B\)</span> is a multinomial distribution over <span class="math inline">\(W\)</span>; and parameters <span class="math inline">\(\lambda &gt; 0\)</span> and <span class="math inline">\(\alpha = (\alpha_1, \ldots, \alpha_k)\)</span> with each <span class="math inline">\(\alpha_i &gt; 0\)</span>. Then a document <span class="math inline">\(d\)</span> is generated as follows:</p>
<ol type="1">
<li>Draw the total length <span class="math inline">\(N_d\)</span> of <span class="math inline">\(d\)</span> from a Poisson distribution, <span class="math inline">\(N_ds \sim \textrm{Poisson}(\lambda)\)</span> (other distributions over the whole numbers might be used here, eg, negative binomial)</li>
<li>Draw a (<span class="math inline">\(k\)</span>-element) topic distribution <span class="math inline">\(\theta_d\)</span> from the Dirichlet distribution defined by <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\theta_d \sim \textrm{Dir}(\alpha)\)</span></li>
<li>For each token <span class="math inline">\(t_i\)</span> (<span class="math inline">\(i = 1, \ldots, N\)</span>),
<ol type="a">
<li>Draw a topic <span class="math inline">\(b_i \sim \textrm{Multinomial}(\theta_d)\)</span></li>
<li>Draw a term from the topic, <span class="math inline">\(t_i \sim b_i\)</span> <span class="citation" data-cites="BleiLatentDirichletAllocation2003">(<a href="#ref-BleiLatentDirichletAllocation2003" role="doc-biblioref">Blei, Ng, and Jordan 2003, 996</a>)</span>.</li>
</ol></li>
</ol>
<p>This generative model is used to define a joint probability distribution that is fit to the data (observed document lengths and token counts) using numerical methods such as variational Bayes.</p>
<p><span class="citation" data-cites="RoheVintageFactorAnalysis2020">Rohe and Zeng (<a href="#ref-RoheVintageFactorAnalysis2020" role="doc-biblioref">2020</a>)</span> take a different approach to topic modeling, viewing it through the lens of principal component analysis (PCA) and the varimax rotation.<br>
Consider a rectangular dataset <span class="math inline">\(X\)</span> with <span class="math inline">\(n\)</span> observations of <span class="math inline">\(p\)</span> variables (<span class="math inline">\(n \times p\)</span>). In a statistics or data science context, PCA is used for <em>dimension reduction</em>, representing these data with <span class="math inline">\(k &lt; p\)</span> dimensions while preserving as much of the original variance as possible. Contemporary approaches to PCA use the singular value decomposition</p>
<p><span class="math display">\[ X = U \Sigma V^t = U L^t \]</span></p>
<p>where <span class="math inline">\(U\)</span> is a <span class="math inline">\(n \times n\)</span> orthogonal matrix (the column vectors are orthogonal and length 1), <span class="math inline">\(\Sigma\)</span> is a <span class="math inline">\(n \times p\)</span> diagonal matrix (all non-diagonal entries are 0), and <span class="math inline">\(V\)</span> is a <span class="math inline">\(p \times p\)</span> orthogonal matrix. <span class="math inline">\(L = V \Sigma^t\)</span> is a <span class="math inline">\(p \times n\)</span> matrix called the <em>loadings</em>. When <span class="math inline">\(p &lt; n\)</span> (that is, more observations than variables) then columns <span class="math inline">\(p+1, p+2, \ldots, n\)</span> of the loadings will be zero, and columns <span class="math inline">\(1, 2, \ldots, p\)</span> can be interpreted as a new set of <span class="math inline">\(p\)</span> variables constructed from the observed <span class="math inline">\(p\)</span> variables. The rows of <span class="math inline">\(U\)</span> are called the <em>scores</em>; they represent the values of the observations in the new variables.</p>
<p>If <span class="math inline">\(X\)</span> is centered (mean of each column/variable is 0) then the SVD is related to the covariance of the original variables in such a way that the new variables are ordered from greatest to least variance, and the original and new variables have the same total variance. So if we restrict our attention to the first <span class="math inline">\(k\)</span> new variables we will have a smaller representation of the original dataset that captures as much of the original variance as possible. Formally, let <span class="math inline">\(U_k\)</span> be the <span class="math inline">\(n \times k\)</span> matrix with columns <span class="math inline">\(1, \ldots, k\)</span> of <span class="math inline">\(U\)</span> and <span class="math inline">\(L_k = V_k \Sigma_k^t\)</span> the corresponding <span class="math inline">\(p \times k\)</span> partial loadings matrix. Then <span class="math inline">\(X \approx U_k \Sigma_k V_k^t\)</span>.</p>
<p>The loadings matrix is generally not easy to interpret, because the new variables are arbitrary linear combinations of the original variables. Such interpretations are essential in factor analysis, which attempts to identify interpretable latent variables from the data, such as psychological constructs corresponding to (weighted) sets of items in a survey instrument.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> Psychometricians proposed to address this problem by finding a <span class="math inline">\(k \times k\)</span> orthogonal<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> matrix <span class="math inline">\(T\)</span></p>
<p><span class="math display">\[ U_k L_k^t = U_k T^t T L_k^t = U_k T^t (L_k T)^t \]</span></p>
<p>that (roughly) makes the “rotated” scores and loadings, <span class="math inline">\(U_k T^t\)</span> and <span class="math inline">\(L_k T\)</span>, as <em>sparse</em> as possible, that is, have as few non-zero entries as possible. This makes the new variables much more interpretable, as generalizations or abstractions of a small collection of observed variables. Because orthogonal matrices generalize rotations and the method for finding this <span class="math inline">\(T\)</span> involves maximizing a total variance, this method is called the <em>varimax rotation</em>.</p>
<p>Finally, to semi-formally motivate a connection between PCA and topic modeling, consider <span class="math inline">\(r_{td}\)</span>, the occurrence rate of term <span class="math inline">\(t\)</span> in document <span class="math inline">\(d\)</span>. This rate estimates the conditional probability of <span class="math inline">\(t\)</span> given <span class="math inline">\(d\)</span>:</p>
<p><span class="math display">\[ r_{td} \approx \Pr(t | d) = \sum_i \Pr(t | b_i) \Pr(b_i | d) = \sum_i b_i \theta_d, \]</span></p>
<p>with a slight abuse of notation, where <span class="math inline">\(i \in 1, \ldots, k\)</span> indexes topics. In other words, topic modeling can be seen as factoring the (more-or-less observed) term-document distribution into two sets of latent distributions, term-topic and topic-document, much like PCA factors a data matrix into scores and loadings in latent variables. See <span class="citation" data-cites="RoheVintageFactorAnalysis2020">Rohe and Zeng (<a href="#ref-RoheVintageFactorAnalysis2020" role="doc-biblioref">2020</a>)</span> lemma 5.2 for a formal development of this connection.</p>
<p>The upshot is that the latent variables constructed using PCA + varimax can be interpreted as topics. Sparsity means that a given document will have near-zero value for all but a few topics, and a given topic will have near-zero value for all but a few documents.</p>
<p>The most obvious potential advantage of this approach is speed. Text data is typically extremely sparse — documents typically contain only a small fraction of the words in the full vocabulary — and efficient algorithms have been developed for partial SVD of sparse matrices <span class="citation" data-cites="BaglamaAugmentedImplicitlyRestarted2005">(<a href="#ref-BaglamaAugmentedImplicitlyRestarted2005" role="doc-biblioref">James Baglama and Reichel 2005</a>)</span>.</p>
<p>The <code>tmfast</code> package implements this PCA + varimax approach to topic modeling in R, with specific support for the widely-used tidyverse idiom. The <code>irlba</code> package <span class="citation" data-cites="BaglamaIrlbaFastTruncated2022">(<a href="#ref-BaglamaIrlbaFastTruncated2022" role="doc-biblioref">Jim Baglama, Reichel, and Lewis 2022</a>)</span> is used for efficient SVD (by default; users can specify an alternative SVD method if they prefer). <code>tmfast</code> is available at <a href="https://github.com/dhicks/tmfast" class="uri">https://github.com/dhicks/tmfast</a>.</p>
</section>
<section id="sec-sim" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Example 1: A simulated corpus</h1>
<p><code>tmfast</code> includes a collection of functions to generate a simulated corpus according to the standard generative model. In this section, we use these functions to generate a corpus, fit topic models using <code>tmfast</code> and <code>stm</code> <span class="citation" data-cites="RobertsStmPackageStructural2019">(<a href="#ref-RobertsStmPackageStructural2019" role="doc-biblioref">Roberts, Stewart, and Tingley 2019</a>)</span> — widely used for topic modeling in R — and compare their respective ability to identify the true topics used to generate the corpus.</p>
<p>We first load the <code>tidyverse</code> suite, the <code>lpSolve</code> package to match fitted and true topics, the <code>tictoc</code> package to calculate wall compute times, and <code>tmfast</code> and <code>stm</code>. The <code>tidytext</code> package is also loaded for its <code>stm</code> tidiers (eg, functions to represent a fitted <code>stm</code> model as a dataframe).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)          <span class="co"># infrastructure</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>())  <span class="co"># make plots not look bad</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lpSolve)            <span class="co"># used to match fitted and true topics</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tictoc)             <span class="co"># timing</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmfast)             <span class="co"># fit topic models fast! </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stm)                <span class="co"># standard topic model package</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytext)           <span class="co"># tidiers for stm models</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="simulation-parameters" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="simulation-parameters"><span class="header-section-number">3.1</span> Simulation parameters</h2>
<p>We create simulated text data following the data-generating process assumed by LDA. Specifically, each document will be generated from one of several “journals.” Each journal corresponds to a topic, and vice versa, in that documents from journal <span class="math inline">\(j\)</span> will tend to have a much greater probability for topic <span class="math inline">\(j\)</span> than the other topics.</p>
<p>We first specify the number of topics/journals <code>k</code>, and the number of documents to draw from each journal <code>Mj</code>, for a total of <code>M = Mj * k</code> documents in the corpus. We also specify the length of the vocabulary (total unique words) as a multiple of the total number of documents <code>M</code>. Document lengths are generated using a negative binomial distribution, using the size-mean parameterization. Per <code>?NegBinomial</code>, the standard deviation of document lengths in this parameterization is <span class="math inline">\(\sqrt{\mu + \frac{\mu^2}{\mathrm{size}}}\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">=</span> <span class="dv">10</span>                <span class="co"># Num. topics / journals</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>Mj <span class="ot">=</span> <span class="dv">100</span>              <span class="co"># Num. documents per journal</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>M <span class="ot">=</span> Mj<span class="sc">*</span>k              <span class="co"># Total corpus size</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>vocab <span class="ot">=</span> M             <span class="co"># Vocabulary length</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Negative binomial distribution of doc lengths</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>size <span class="ot">=</span> <span class="dv">10</span>             <span class="co"># Size and mean</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">=</span> <span class="dv">300</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(mu <span class="sc">+</span> mu<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>size)  <span class="co"># Resulting SD of document sizes</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 96.43651</code></pre>
</div>
</div>
<p>Topic-document and word-topic distributions are both sampled from Dirichlet distributions. For topic-docs, we use an asymmetric Dirichlet distribution<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> where one component will have (in expectation) most of the probability mass (eg, 80%) and the remaining probability mass will be (in expectation) distributed evenly over the remaining components (eg, <span class="math inline">\(0.2/(k-1)\)</span>). For word-topics we use a symmetric Dirichlet distribution (parametized only by the scaling factor). <code>tmfast</code> includes utility functions for constructing and drawing both kinds of Dirichlet distributions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Dirichlet distributions for topic-docs and word-topics</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>topic_peak <span class="ot">=</span> .<span class="dv">8</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>topic_scale <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">peak_alpha</span>(k, <span class="dv">1</span>, <span class="at">peak =</span> topic_peak, <span class="at">scale =</span> topic_scale)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 8.0000000 0.2222222 0.2222222 0.2222222 0.2222222 0.2222222 0.2222222
 [8] 0.2222222 0.2222222 0.2222222</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">peak_alpha</span>(k, <span class="dv">2</span>, <span class="at">peak =</span> topic_peak, <span class="at">scale =</span> topic_scale)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0.2222222 8.0000000 0.2222222 0.2222222 0.2222222 0.2222222 0.2222222
 [8] 0.2222222 0.2222222 0.2222222</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>word_beta <span class="ot">=</span> <span class="fl">0.1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Because the simulations involve drawing samples using a RNG, we set a seed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022-06-19</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="draw-true-topic-distributions" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="draw-true-topic-distributions"><span class="header-section-number">3.2</span> Draw true topic distributions</h2>
<p>We generate the true topic-document distributions <span class="math inline">\(p(\theta = t | \mathrm{doc}_m)\)</span>, often simply notated <span class="math inline">\(\theta\)</span> or <span class="math inline">\(\gamma\)</span>. In this vignette we use <span class="math inline">\(\theta\)</span> for the true distribution and <span class="math inline">\(\gamma\)</span> for the fitted distribution in the topic model. Each document’s <span class="math inline">\(\theta\)</span> is sampled from a Dirichlet distribution (<code>rdirichlet()</code>), with the parameter <span class="math inline">\(\mathbf{\alpha}\)</span> corresponding to the document’s journal <span class="math inline">\(j\)</span>. The variable <code>theta</code> is a <code>M</code> by <code>k</code> matrix; <code>theta_df</code> is a tidy representation with columns <code>doc</code>, <code>topic</code>, and <code>prob</code>. The visualization confirms that documents are generally most strongly associated with the corresponding topics, though with some noise: in the median document, 82% of its topic probability mass is associated with the single dominant topic.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Journal-specific alpha, with a peak value (80%) and uniform otherwise; </span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="do">## For each topic, draw Mj documents</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">=</span> <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span>k, </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>            <span class="sc">~</span><span class="fu">rdirichlet</span>(Mj, </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">peak_alpha</span>(k, .x, </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">peak =</span> topic_peak, </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">scale =</span> topic_scale))) <span class="sc">|&gt;</span> </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">reduce</span>(rbind)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>theta_df <span class="ot">=</span> theta <span class="sc">|&gt;</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">'doc'</span>, </span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">.name_repair =</span> tmfast<span class="sc">:::</span>make_colnames) <span class="sc">|&gt;</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">doc =</span> <span class="fu">as.integer</span>(doc)) <span class="sc">|&gt;</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">'V'</span>),</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>                 <span class="at">names_to =</span> <span class="st">'topic'</span>,</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>                 <span class="at">values_to =</span> <span class="st">'theta'</span>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>theta_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10,000 × 3
     doc topic      theta
   &lt;int&gt; &lt;chr&gt;      &lt;dbl&gt;
 1     1 V01   0.872     
 2     1 V02   0.0644    
 3     1 V03   0.0278    
 4     1 V04   0.00169   
 5     1 V05   0.00249   
 6     1 V06   0.00137   
 7     1 V07   0.00693   
 8     1 V08   0.000124  
 9     1 V09   0.00000643
10     1 V10   0.0235    
# … with 9,990 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(theta_df, <span class="fu">aes</span>(doc, topic, <span class="at">fill =</span> theta)) <span class="sc">+</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="paper_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>theta_df <span class="sc">|&gt;</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(doc) <span class="sc">|&gt;</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">max =</span> <span class="fu">max</span>(theta)) <span class="sc">|&gt;</span> </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(max) <span class="sc">|&gt;</span> </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.3567  0.7148  0.8192  0.7958  0.8963  0.9901 </code></pre>
</div>
</div>
</section>
<section id="draw-true-word-distributions" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="draw-true-word-distributions"><span class="header-section-number">3.3</span> Draw true word distributions</h2>
<p>Next we generate the true word-topic distributions <span class="math inline">\(p(\phi = w | \theta = t)\)</span>, often designed as either <span class="math inline">\(\phi\)</span> or <span class="math inline">\(\beta\)</span>. We use <span class="math inline">\(\phi\)</span> for the true distribution and <span class="math inline">\(\beta\)</span> for the fitted distribution. We sample these distributions from a symmetric Dirichlet distribution over the length of the vocabulary with <span class="math inline">\(\alpha = .01\)</span>. Tile and Zipfian (probability vs.&nbsp;rank on a log-log scale) plots confirm these distributions are working correctly.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="do">## phi_j:  Word distribution for topic j</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>phi <span class="ot">=</span> <span class="fu">rdirichlet</span>(k, word_beta, <span class="at">k =</span> vocab)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>phi_df <span class="ot">=</span> phi <span class="sc">|&gt;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">t</span>() <span class="sc">|&gt;</span> </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">'token'</span>, </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">.name_repair =</span> tmfast<span class="sc">:::</span>make_colnames) <span class="sc">|&gt;</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">'V'</span>),</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">names_to =</span> <span class="st">'topic'</span>,</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">values_to =</span> <span class="st">'phi'</span>)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>phi_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10,000 × 3
   token topic      phi
   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt;
 1 1     V01   2.28e- 4
 2 1     V02   2.51e-18
 3 1     V03   4.06e- 4
 4 1     V04   5.86e- 4
 5 1     V05   5.73e- 8
 6 1     V06   1.04e- 5
 7 1     V07   2.67e- 4
 8 1     V08   9.02e- 6
 9 1     V09   1.00e-25
10 1     V10   2.03e- 4
# … with 9,990 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Word distributions</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(phi_df, <span class="fu">aes</span>(topic, token, <span class="at">fill =</span> (phi))) <span class="sc">+</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_discrete</span>(<span class="at">breaks =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="paper_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Zipfian plot</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>phi_df <span class="sc">|&gt;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(topic) <span class="sc">|&gt;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">rank</span>(<span class="fu">desc</span>(phi))) <span class="sc">|&gt;</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(topic, rank) <span class="sc">|&gt;</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(rank <span class="sc">&lt;</span> vocab<span class="sc">/</span><span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(rank, phi, <span class="at">color =</span> topic)) <span class="sc">+</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_log10</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="paper_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="document-lengths" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="document-lengths"><span class="header-section-number">3.4</span> Document lengths</h2>
<p>Again, document lengths are drawn from a negative binomial distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="do">## N_i:  Length of document i</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">=</span> <span class="fu">rnbinom</span>(M, <span class="at">size =</span> size, <span class="at">mu =</span> mu)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(N)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   93.0   240.8   300.5   308.6   364.5   774.0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(N)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 95.1555</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(N)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="paper_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="draw-corpus" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="draw-corpus"><span class="header-section-number">3.5</span> Draw corpus</h2>
<p>Finally we draw the corpus, the observed word counts for each document. This is the most time-consuming step in this script, much slower than actually fitting the topic model. Experimenting with this simulation, we found that <code>log1p()</code> scaling of the word counts produced better results than other scaling techniques (eg, dividing by the total length of each document, scaling words by their standard deviation) for accounting for radical differences in document length.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<div class="cell" data-hash="paper_cache/html/unnamed-chunk-8_4b878b642742c5bb2ae63f54002de3f8">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tic</span>()</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>corpus <span class="ot">=</span> <span class="fu">draw_corpus</span>(N, theta, phi)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">toc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>26.149 sec elapsed</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>dtm <span class="ot">=</span> <span class="fu">mutate</span>(corpus, <span class="at">n =</span> <span class="fu">log1p</span>(n))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="fit-the-topic-model" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="fit-the-topic-model"><span class="header-section-number">3.6</span> Fit the topic model</h2>
<p>Fitting the topic model is extremely fast. Note that we can request multiple values of <span class="math inline">\(k\)</span> (numbers of topics) in a single call. Other topic modelling packages typically fit only a single value of <span class="math inline">\(k\)</span> at a time.</p>
<p>Under the hood, we cast the document-term matrix to a sparse matrix class if necessary. Then we extract the maximum number of desired principal components using <code>irlba::prcomp_irlba()</code>, centering but not scaling the logged word counts. (Experiments with this simulation indicated that scaling makes it more difficult to construct probability distributions later.) Next we use the base R function <code>stats:varimax()</code> to construct a preliminary varimax rotation of the principal components. Because the direction of factors is arbitrary as far as varimax is concerned, but meaningful when we convert things to probability distributions, we check the skew of each factor’s loadings in the preliminary fit, and reverse the factors with negative skew (long left tails with relatively large negative values).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tic</span>()</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>fitted <span class="ot">=</span> <span class="fu">tmfast</span>(dtm, <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, k, <span class="dv">2</span><span class="sc">*</span>k))</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">toc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.701 sec elapsed</code></pre>
</div>
</div>
<p>The object returned by <code>tmfast()</code> has a simple structure (pun intended) and the <code>tmfast</code> S3 class. <code>totalvar</code> and <code>sdev</code> come from the PCA step, giving the total variance across all feature variables and the standard deviation of each extracted principal component. (Note that these PCs do not generally correspond to the varimax-rotated factors/topics.) <code>n</code> contains the sizes (number of factors/topics) fitted for the models, and <code>varimaxes</code> contains the varimax fit for each value of <code>n</code>. The varimax objects each contain three matrices, the rotated <code>loadings</code> (word-topics), the rotation matrix <code>rotmat</code>, and the rotated <code>scores</code> (document-topics). Note that these are not stored as probability distributions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(fitted, <span class="at">max.level =</span> 2L)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 9
 $ totalvar: num 138
 $ sdev    : num [1:20] 3.26 3.06 3.01 2.97 2.93 ...
 $ rows    : chr [1:1000] "1" "2" "3" "4" ...
 $ cols    : chr [1:999] "5" "7" "8" "11" ...
 $ center  : Named num [1:999] 0.4016 0.0943 0.4254 0.2396 0.4093 ...
  ..- attr(*, "names")= chr [1:999] "5" "7" "8" "11" ...
 $ scale   : logi FALSE
 $ rotation: num [1:999, 1:20] -0.00112 0.02725 0.01223 0.00457 -0.00883 ...
  ..- attr(*, "dimnames")=List of 2
 $ n       : num [1:4] 3 5 10 20
 $ varimax :List of 4
  ..$ 3 :List of 3
  ..$ 5 :List of 3
  ..$ 10:List of 3
  ..$ 20:List of 3
 - attr(*, "class")= chr [1:3] "tmfast" "varimaxes" "list"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(fitted<span class="sc">$</span>varimax[<span class="fu">as.character</span>(k)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 1
 $ 10:List of 3
  ..$ loadings: num [1:999, 1:10] -0.0479 0.1025 0.0436 -0.0414 -0.0505 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:999] "5" "7" "8" "11" ...
  .. .. ..$ : NULL
  ..$ rotmat  : num [1:10, 1:10] 0.784 -0.2228 -0.23 -0.0823 0.3342 ...
  ..$ scores  : num [1:1000, 1:10] -0.384 -0.137 -0.253 -0.298 -0.388 ...
  .. ..- attr(*, "dimnames")=List of 2
  .. .. ..$ : chr [1:1000] "1" "2" "3" "4" ...
  .. .. ..$ : NULL</code></pre>
</div>
</div>
<p>Because the model contains a <code>sdev</code> component, <code>screeplot()</code> works out of the box. Note that the first <span class="math inline">\(k\)</span> PCs have much higher variance than the others, and often the <span class="math inline">\(k\)</span>th PC is somewhat lower than the first <span class="math inline">\(k-1\)</span>. This reflects the highly simplified structure of the simulated data. Real datasets often have a much more gradual decline in the screeplot, likely reflecting the complex hierarchy of topics in actual documents.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">screeplot</span>(fitted, <span class="at">npcs =</span> k <span class="sc">+</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="paper_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>It’s also straightforward to calculate the share of total variance covered by successive principal components. Experimenting with this simulation, it’s common for <span class="math inline">\(k\)</span> principal components to cover less than half of the total variance. Again, note that the rotated varimax factors don’t correspond to the principal components, but the total covered variance remains the same.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cumsum</span>(fitted<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> fitted<span class="sc">$</span>totalvar</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0.07689789 0.14466433 0.21018176 0.27420309 0.33636478 0.39492291
 [7] 0.45196354 0.50563725 0.55705654 0.57380104 0.57606900 0.57828256
[13] 0.58048004 0.58264465 0.58479395 0.58691426 0.58902127 0.59107016
[19] 0.59311409 0.59514063</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">PC =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(fitted<span class="sc">$</span>sdev),</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">cum_var =</span> <span class="fu">cumsum</span>(fitted<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> fitted<span class="sc">$</span>totalvar) <span class="sc">|&gt;</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(PC, cum_var)) <span class="sc">+</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="paper_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="fitting-a-conventional-topic-model-stm" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="fitting-a-conventional-topic-model-stm"><span class="header-section-number">3.7</span> Fitting a conventional topic model (stm)</h2>
<p>For comparison, we’ll also fit a conventional topic model using the <code>stm</code> package. To address the challenge of picking a number of topics, <code>stm::stm()</code> conducts a topic estimation process when passed <code>K = 0</code>. With the simulation parameters and the random seed used here, this process takes almost 12 seconds and produces a model with 33 topics. We therefore do not run the code below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tic</span>()</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>corpus <span class="sc">|&gt;</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cast_sparse</span>(doc, word, n) <span class="sc">|&gt;</span> </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stm</span>(<span class="at">K =</span> <span class="dv">0</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="fu">toc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Setting <code>K = k</code> gives us a fitted topic model in a few seconds, about an order of magnitude slower than <code>tmfast()</code>. Profiling experiments indicated that <code>tmfast()</code> is about 20x faster than <code>stm()</code>.</p>
<div class="cell" data-hash="paper_cache/html/unnamed-chunk-14_4548da94286809ace0024d109f29850f">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tic</span>()</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>fitted_stm <span class="ot">=</span> corpus <span class="sc">|&gt;</span> </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cast_sparse</span>(doc, word, n) <span class="sc">|&gt;</span> </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stm</span>(<span class="at">K =</span> k, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="fu">toc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>5.088 sec elapsed</code></pre>
</div>
</div>
</section>
<section id="assessing-accuracy-word-topic-distributions" class="level2" data-number="3.8">
<h2 data-number="3.8" class="anchored" data-anchor-id="assessing-accuracy-word-topic-distributions"><span class="header-section-number">3.8</span> Assessing accuracy: Word-topic distributions</h2>
<p>Using simulated data with true word-topic and topic-document distributions enables us to check the accuracy of both <code>tmfast</code> and <code>stm</code> models. Here we’ll develop a method proposed by <span class="citation" data-cites="MalaterreEarlyDaysContemporary2022">Malaterre and Lareau (<a href="#ref-MalaterreEarlyDaysContemporary2022" role="doc-biblioref">2022</a>)</span>, comparing distributions using Hellinger distance. For discrete probability distributions <span class="math inline">\(p, q\)</span> over the same space <span class="math inline">\(X\)</span>, the Hellinger distance is given by</p>
<p><span class="math display">\[ d(p,q) = \frac{1}{\sqrt{2}} \sqrt{\sum_{x \in X} (\sqrt{p(x)} - \sqrt{q(x)})^2} = \frac{1}{\sqrt{2}} \lVert \sqrt p - \sqrt q \rVert_2. \]</span></p>
<p>The last equation means that the Hellinger distance is the Euclidean (<span class="math inline">\(L^2\)</span>-norm) distance between the <em>square roots</em> of the distributions. Some authors working with topic models sometimes compare distributions using the <span class="math inline">\(L^2\)</span>-norm of the distributions themselves, without the square root. But this approach is flawed, since probability distributions can have different lengths in the <span class="math inline">\(L^2\)</span> norm. (For example, the distribution <span class="math inline">\((1, 0)\)</span> has <span class="math inline">\(L^2\)</span> length 1, while <span class="math inline">\((\frac{1}{2}, \frac{1}{2} )\)</span> has <span class="math inline">\(L^2\)</span> length approximately 1.19.) Cosine similarity, which is also widely used by text analysts, is directly related to the <span class="math inline">\(L^2\)</span>-norm and has the same problem.</p>
<p>Hellinger distance satisfies the equation <span class="math display">\[ 1 - d^2(p, q) = \sum_{x \in X} \sqrt{p(x)q(x)}. \]</span> When working with topic models, we’re interested in pairwise sets of Hellinger distances, either between all pairs of distributions from a single set <span class="citation" data-cites="HicksProductivityInterdisciplinaryImpacts2021">(for example, the topic distributions for each document, as used in “discursive space” analysis; <a href="#ref-HicksProductivityInterdisciplinaryImpacts2021" role="doc-biblioref">Hicks 2021</a>)</span> or two sets <span class="citation" data-cites="MalaterreEarlyDaysContemporary2022">(such comparing fitted vs.&nbsp;true word-topic distributions as below; or word-topic distributions for two models fitted on the same corpus but different vocabularies, <a href="#ref-MalaterreEarlyDaysContemporary2022" role="doc-biblioref">Malaterre and Lareau 2022</a>)</span>. Working with two sets of distributions <span class="math inline">\(P = \{p_i | i \in I\}\)</span> and <span class="math inline">\(Q = \{q_j | j \in J\}\)</span>, the right-hand side of the last equation is equivalent to a matrix multiplication.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> The <code>tmfast::hellinger()</code> function provides S3 methods for calculating Hellinger pairwise distances given a single dataframe, single matrix, or two dataframes or matrices.</p>
<p>First, however, we need to extract the word-topic distributions. <code>tmfast</code> provides a <code>tidy()</code> method, following the pattern of the topic model tidiers in the <code>tidytext</code> package. Unlike other topic models, <code>tmfast</code> objects can contain multiple models for different values of <span class="math inline">\(k\)</span>. So, in the second argument to <code>tidy()</code>, we need to specify which number of topics we want. The third argument specifies the desired set of distributions, either word-topics (<code>'beta'</code>) or topic-documents (<code>'gamma'</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="do">## beta: fitted varimax loadings, transformed to probability distributions</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">=</span> <span class="fu">tidy</span>(fitted, k, <span class="st">'beta'</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>beta</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,734 × 3
   token topic     beta
   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt;
 1 5     V02   0.0198  
 2 5     V08   0.00454 
 3 7     V01   0.00344 
 4 7     V02   0.00276 
 5 7     V06   0.000318
 6 8     V01   0.00146 
 7 8     V02   0.00522 
 8 8     V09   0.0195  
 9 11    V02   0.0114  
10 11    V04   0.00610 
# … with 2,724 more rows</code></pre>
</div>
</div>
<p>Word-topic distributions correspond to the varimax factor loadings. These loadings can take any real value. To convert them to probability distributions, within each factor (topic), we trim negative values to 0 and divide each loading by the sum of all loadings. The Zipfian plot below compares the fitted and true word-topic distributions. Consistently across experiments with this simulation, fitted distributions started off a little flatter, then dropped sharply after about 100 words. In other words, the varimax topic model highlights a relatively long list of characteristic words for each topic — the actual distributions have fewer characteristic words — and then ignores the other words.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Compare Zipfian distributions</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">mutate</span>(beta, <span class="at">type =</span> <span class="st">'fitted'</span>), </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>          {phi_df <span class="sc">|&gt;</span> </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">rename</span>(<span class="at">beta =</span> phi) <span class="sc">|&gt;</span> </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">'true'</span>)}) <span class="sc">|&gt;</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(type, topic) <span class="sc">|&gt;</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">rank</span>(<span class="fu">desc</span>(beta))) <span class="sc">|&gt;</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(type, topic, rank) <span class="sc">|&gt;</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(rank <span class="sc">&lt;</span> vocab<span class="sc">/</span><span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(rank, beta, </span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> type, </span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">group =</span> <span class="fu">interaction</span>(topic, type))) <span class="sc">+</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_log10</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="paper_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The Zipfian distribution doesn’t tell us which fitted topics might correspond to which true topics. For that, following <span class="citation" data-cites="MalaterreEarlyDaysContemporary2022">Malaterre and Lareau (<a href="#ref-MalaterreEarlyDaysContemporary2022" role="doc-biblioref">2022</a>)</span>, we’ll use pairwise Hellinger distances. There’s one complication, however. The parameters chosen for this simulation typically end up not drawing some of the words from the vocabulary, and they don’t end up in the same order as the true word-topic matrix <code>phi</code>. Fortunately words are represented as the integers <code>1:vocab</code>, so it’s relatively painless to put them back in order and fill in the gaps (setting the probability for the missing words to be 0 across all topics). In the code block below, we first fix these issues with the words, widen the long dataframe, convert it to a matrix, and then calculate pairwise Hellinger distances with the true word-topic matrix <code>phi</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Hellinger distance of word-topic distributions</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>beta_mx <span class="ot">=</span> beta <span class="sc">|&gt;</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Fix order of words</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">token =</span> <span class="fu">as.integer</span>(token)) <span class="sc">|&gt;</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(token) <span class="sc">|&gt;</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    <span class="do">## And dropped words</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">complete</span>(<span class="at">token =</span> <span class="dv">1</span><span class="sc">:</span>vocab, topic, <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">beta =</span> <span class="dv">0</span>)) <span class="sc">|&gt;</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">build_matrix</span>(token, topic, beta, <span class="at">sparse =</span> <span class="cn">FALSE</span>)</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="fu">hellinger</span>(phi, <span class="fu">t</span>(beta_mx)) <span class="sc">|&gt;</span> </span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        V01   V02   V03   V04   V05   V06   V07   V08   V09   V10
 [1,] 0.903 0.164 0.917 0.912 0.875 0.900 0.904 0.922 0.885 0.893
 [2,] 0.906 0.878 0.910 0.899 0.157 0.915 0.891 0.904 0.887 0.903
 [3,] 0.911 0.878 0.908 0.877 0.895 0.896 0.886 0.914 0.177 0.922
 [4,] 0.936 0.918 0.167 0.907 0.907 0.878 0.912 0.908 0.911 0.914
 [5,] 0.895 0.905 0.903 0.898 0.887 0.902 0.183 0.880 0.882 0.891
 [6,] 0.923 0.912 0.878 0.893 0.910 0.181 0.901 0.896 0.893 0.906
 [7,] 0.164 0.907 0.938 0.892 0.902 0.931 0.900 0.903 0.911 0.916
 [8,] 0.915 0.888 0.916 0.898 0.900 0.907 0.887 0.880 0.925 0.171
 [9,] 0.896 0.915 0.901 0.168 0.899 0.903 0.898 0.897 0.887 0.900
[10,] 0.911 0.915 0.905 0.894 0.900 0.887 0.884 0.162 0.926 0.882</code></pre>
</div>
</div>
<p>In this distance matrix, the rows are the true topics and the columns are the fitted topics. Low values correspond to greater similarity. It’s clear that the topics don’t match up perfectly — the minimum in each row is about 0.17 — but there is a clear minimum. We treat this as a linear assignment problem, which is solved rapidly using the <code>lpSolve</code> package. The solution — which matches true to fitted topics — can then be used as a rotation with both the loadings and scores (topic-document distributions). After rotating, the true-fitted pairs are on the diagonal of the Hellinger distance matrix, making it easy to extract and summarize the quality of the fit.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Use lpSolve to match fitted topics to true topics</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>dist <span class="ot">=</span> <span class="fu">hellinger</span>(phi, <span class="fu">t</span>(beta_mx))</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>rotation <span class="ot">=</span> <span class="fu">lp.assign</span>(dist)<span class="sc">$</span>solution</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>rotation</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]
 [1,]    0    1    0    0    0    0    0    0    0     0
 [2,]    0    0    0    0    1    0    0    0    0     0
 [3,]    0    0    0    0    0    0    0    0    1     0
 [4,]    0    0    1    0    0    0    0    0    0     0
 [5,]    0    0    0    0    0    0    1    0    0     0
 [6,]    0    0    0    0    0    1    0    0    0     0
 [7,]    1    0    0    0    0    0    0    0    0     0
 [8,]    0    0    0    0    0    0    0    0    0     1
 [9,]    0    0    0    1    0    0    0    0    0     0
[10,]    0    0    0    0    0    0    0    1    0     0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Hellinger distance comparison using the lpSolve matching</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hellinger</span>(phi, rotation <span class="sc">%*%</span> <span class="fu">t</span>(beta_mx)) <span class="sc">|&gt;</span> </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       [,1]  [,2]  [,3]  [,4]  [,5]  [,6]  [,7]  [,8]  [,9] [,10]
 [1,] 0.164 0.875 0.885 0.917 0.904 0.900 0.903 0.893 0.912 0.922
 [2,] 0.878 0.157 0.887 0.910 0.891 0.915 0.906 0.903 0.899 0.904
 [3,] 0.878 0.895 0.177 0.908 0.886 0.896 0.911 0.922 0.877 0.914
 [4,] 0.918 0.907 0.911 0.167 0.912 0.878 0.936 0.914 0.907 0.908
 [5,] 0.905 0.887 0.882 0.903 0.183 0.902 0.895 0.891 0.898 0.880
 [6,] 0.912 0.910 0.893 0.878 0.901 0.181 0.923 0.906 0.893 0.896
 [7,] 0.907 0.902 0.911 0.938 0.900 0.931 0.164 0.916 0.892 0.903
 [8,] 0.888 0.900 0.925 0.916 0.887 0.907 0.915 0.171 0.898 0.880
 [9,] 0.915 0.899 0.887 0.901 0.898 0.903 0.896 0.900 0.168 0.897
[10,] 0.915 0.900 0.926 0.905 0.884 0.887 0.911 0.882 0.894 0.162</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hellinger</span>(phi, rotation <span class="sc">%*%</span> <span class="fu">t</span>(beta_mx)) <span class="sc">|&gt;</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">diag</span>() <span class="sc">|&gt;</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.1569  0.1639  0.1674  0.1693  0.1755  0.1829 </code></pre>
</div>
</div>
<p>And we do the same thing with the <code>stm</code> topic model. <strong><code>stm</code> is somewhat more accurate than <code>tmfast</code>, with a median Hellinger distance of about 0.07 compared to 0.18. But <code>stm</code> is significantly slower.</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>beta_stm_mx <span class="ot">=</span> <span class="fu">tidy</span>(fitted_stm, <span class="at">matrix =</span> <span class="st">'beta'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Fix order of words</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">as.integer</span>(term)) <span class="sc">|&gt;</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(term) <span class="sc">|&gt;</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    <span class="do">## And dropped words</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">complete</span>(<span class="at">term =</span> <span class="dv">1</span><span class="sc">:</span>vocab, topic, </span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">beta =</span> <span class="dv">0</span>)) <span class="sc">|&gt;</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">build_matrix</span>(term, topic, beta, <span class="at">sparse =</span> <span class="cn">FALSE</span>)</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="fu">hellinger</span>(phi, <span class="fu">t</span>(beta_stm_mx)) <span class="sc">|&gt;</span> </span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           1     2      3      4      5      6      7      8     9    10
 [1,] 0.0855 0.843 0.8425 0.8821 0.8744 0.8716 0.8505 0.8654 0.879 0.868
 [2,] 0.8433 0.854 0.0823 0.8700 0.8585 0.8696 0.8616 0.8703 0.860 0.854
 [3,] 0.8481 0.085 0.8497 0.8587 0.8349 0.8773 0.8822 0.8583 0.873 0.845
 [4,] 0.8873 0.865 0.8760 0.0872 0.8614 0.9034 0.8730 0.8366 0.867 0.873
 [5,] 0.8651 0.842 0.8420 0.8669 0.8518 0.8549 0.8460 0.8605 0.838 0.079
 [6,] 0.8928 0.855 0.8715 0.8369 0.8477 0.8910 0.8628 0.0888 0.854 0.863
 [7,] 0.8760 0.875 0.8694 0.8950 0.8614 0.0843 0.8747 0.8954 0.867 0.857
 [8,] 0.8618 0.885 0.8710 0.8777 0.8576 0.8821 0.0927 0.8705 0.845 0.853
 [9,] 0.8827 0.840 0.8683 0.8580 0.0904 0.8601 0.8518 0.8531 0.853 0.858
[10,] 0.8822 0.878 0.8630 0.8688 0.8516 0.8734 0.8460 0.8559 0.091 0.846</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>rotation_stm <span class="ot">=</span> <span class="fu">hellinger</span>(phi, <span class="fu">t</span>(beta_stm_mx)) <span class="sc">|&gt;</span> </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lp.assign</span>() <span class="sc">|&gt;</span> </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    magrittr<span class="sc">::</span><span class="fu">extract2</span>(<span class="st">'solution'</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="fu">hellinger</span>(phi, rotation_stm <span class="sc">%*%</span> <span class="fu">t</span>(beta_stm_mx)) <span class="sc">|&gt;</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">diag</span>() <span class="sc">|&gt;</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
0.07902 0.08445 0.08634 0.08661 0.08999 0.09268 </code></pre>
</div>
</div>
<p>The tidied word-topic distributions can be used in standard ways for further analysis, such as a <a href="https://juliasilge.com/blog/2018/2018-01-25-sherlock-holmes-stm_files/figure-html/unnamed-chunk-6-1.png">Silge plot</a> of the highest probability words for each topic. But because the “words” in this simulation are just integers, and not semantically meaningful, we don’t construct such a plot here.</p>
</section>
<section id="renormalization-topic-document-distributions" class="level2" data-number="3.9">
<h2 data-number="3.9" class="anchored" data-anchor-id="renormalization-topic-document-distributions"><span class="header-section-number">3.9</span> Renormalization: Topic-document distributions</h2>
<p>Finally, we compare fitted and true topic-document distributions. We extract topic-document distributions using the same <code>tidy()</code> function, specifying the matrix <code>gamma</code> and including the rotation above to align the fitted and true topics. Tile and parallel coordinates plots can be used to visualize all of the topic-document distributions. These show that the <code>tmfast</code> models successfully recover the overall association of each document’s journal with a distinctive topic.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>gamma_df <span class="ot">=</span> <span class="fu">tidy</span>(fitted, k, <span class="st">'gamma'</span>, </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">rotation =</span> rotation) <span class="sc">|&gt;</span> </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">document =</span> <span class="fu">as.integer</span>(document),</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">journal =</span> (document <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">%/%</span> Mj <span class="sc">+</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in tidy.tmfast(fitted, k, "gamma", rotation = rotation): Rotating
scores</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gamma_df, <span class="fu">aes</span>(document, topic, <span class="at">fill =</span> gamma)) <span class="sc">+</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_raster</span>() <span class="sc">+</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="paper_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gamma_df, </span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(topic, gamma, </span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">group =</span> document, </span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="fu">as.factor</span>(journal))) <span class="sc">+</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">alpha =</span> .<span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(journal)) <span class="sc">+</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>(<span class="at">guide =</span> <span class="st">'none'</span>) <span class="sc">+</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="st">'none'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="paper_files/figure-html/unnamed-chunk-20-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>However, the fitted topic-document distributions are flatter than the true ones. Consider the true and fitted distributions for document 1. Compared to the true distribution, the fitted distribution has a somewhat lower probability for topic <code>V01</code> and a somewhat higher probability for the other topics.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(topic, <span class="at">group =</span> 1L)) <span class="sc">+</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> theta, <span class="at">color =</span> <span class="st">'true'</span>), </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> <span class="fu">filter</span>(theta_df, doc <span class="sc">==</span> <span class="st">'1'</span>)) <span class="sc">+</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> gamma, <span class="at">color =</span> <span class="st">'fitted'</span>), </span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> <span class="fu">filter</span>(gamma_df, document <span class="sc">==</span> <span class="st">'1'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="paper_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This flatter distribution corresponds to greater entropy. In this simulation, the entropy of the fitted distributions are about 1 bit greater than those of the true distributions. This discrepancy tends to become worse with greater values of <span class="math inline">\(k\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>theta_df <span class="sc">|&gt;</span> </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(doc) <span class="sc">|&gt;</span> </span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">H =</span> <span class="fu">entropy</span>(theta)) <span class="sc">|&gt;</span> </span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(H) <span class="sc">|&gt;</span> </span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.1006  0.6614  0.9715  1.0100  1.3311  2.5821 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>gamma_df <span class="sc">|&gt;</span> </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(document) <span class="sc">|&gt;</span> </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">H =</span> <span class="fu">entropy</span>(gamma)) <span class="sc">|&gt;</span> </span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(H) <span class="sc">|&gt;</span> </span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.8486  1.7040  1.9319  1.9129  2.1592  2.7673 </code></pre>
</div>
</div>
<p>To mitigate this problem, we add an optional renormalization step when converting document scores to topic-document distributions. Given a discrete probability distribution <span class="math inline">\(P\)</span> with components <span class="math inline">\(p_i\)</span> and entropy <span class="math inline">\(H\)</span>, and a parameter <span class="math inline">\(\beta\)</span>, we can define a new distribution <span class="math inline">\(P'\)</span> with components</p>
<p><span class="math display">\[ p'_i = \frac{p_i^\beta}{\sum_i p_i^\beta} = \frac{p_i^\beta}{Z}\]</span></p>
<p>which has entropy</p>
<p><span class="math display">\[ H' = \frac{1}{Z} \sum_i [p_i^\beta \beta \log p_i] - \log Z.\]</span></p>
<p>That is, we can choose a parameter <span class="math inline">\(\beta\)</span> that renormalizes <span class="math inline">\(P\)</span> to achieve a target entropy <span class="math inline">\(H'\)</span>. In LDA, the target entropy is the expected entropy for topic-document distributions drawn from the asymmetric Dirichlet prior. <code>tmfast</code> provides convenience functions for calculating this expected entropy; compare this to the mean entropy of the distributions in <code>theta</code> above. <strong>In actual applications, where the Dirichlet prior is an idealization, choosing <span class="math inline">\(\alpha\)</span> to set the target entropy is an important researcher degree of freedom.</strong> It is equivalent to choosing prior parameters in other topic modeling packages.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">expected_entropy</span>(<span class="fu">peak_alpha</span>(k, <span class="dv">1</span>, topic_peak, topic_scale))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.997604</code></pre>
</div>
</div>
<p>Since solving the equation for <span class="math inline">\(H'\)</span> for <span class="math inline">\(\beta\)</span> requires numerical optimization, it’s inefficient to do this every time we call <code>tidy()</code>, especially with large corpora. Instead, <code>tmfast::target_power()</code> is used to run this optimization once, and then return the mean value across all documents. We then use this single value of <span class="math inline">\(\beta\)</span> in all future calls to <code>tidy()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>gamma_power <span class="ot">=</span> <span class="fu">tidy</span>(fitted, k, <span class="st">'gamma'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">target_power</span>(document, gamma, </span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">expected_entropy</span>(<span class="fu">peak_alpha</span>(k, </span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>                                             <span class="dv">1</span>, </span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>                                             topic_peak, </span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>                                             topic_scale)))</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>gamma_power</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.539377</code></pre>
</div>
</div>
<p>The renormalized topic-document distributions have closer entropy to <span class="math inline">\(\theta\)</span>. The <code>keep_original</code> argument lets us compare the original and renormalized distributions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>gamma_df <span class="ot">=</span> <span class="fu">tidy</span>(fitted, k, <span class="st">'gamma'</span>, </span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">rotation =</span> rotation, </span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">exponent =</span> gamma_power, </span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">keep_original =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">document =</span> <span class="fu">as.integer</span>(document),</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">journal =</span> (document <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">%/%</span> Mj <span class="sc">+</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in tidy.tmfast(fitted, k, "gamma", rotation = rotation, exponent =
gamma_power, : Rotating scores</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>gamma_df <span class="sc">|&gt;</span> </span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(document) <span class="sc">|&gt;</span> </span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">c</span>(gamma, gamma_rn), entropy)) <span class="sc">|&gt;</span> </span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">c</span>(gamma, gamma_rn), mean))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  gamma gamma_rn
  &lt;dbl&gt;    &lt;dbl&gt;
1  1.91     1.03</code></pre>
</div>
</div>
<p>We can now assess accuracy of the topic-document distributions. Above we used the <code>hellinger()</code> method for two matrices. The method for two dataframes requires specifying the id, topic, and probability columns. The tile plot shows that the true and fitted topics are aligned (because we used the rotation when extracting <code>gamma_df</code> above), and so again we can get an overall summary from the diagonal. Without renormalization, in the current simulation the mean Hellinger distance is 0.24 — not too bad, but perhaps larger than one would like. With larger values of <span class="math inline">\(k\)</span>, this accuracy increases significantly. Renormalization keeps the mean distance around 0.13, comparable to the word-topic distributions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="do">## w/o renormalization, mean distance is .24</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hellinger</span>(theta_df, doc, <span class="at">prob1 =</span> theta,</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">topicsdf2 =</span> gamma_df, </span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">id2 =</span> document, </span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">prob2 =</span> gamma, <span class="at">df =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">diag</span>() <span class="sc">|&gt;</span> </span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
0.08499 0.20131 0.23733 0.23770 0.27244 0.37585 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="do">## w/ renormalization, mean distance drops to .13</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>doc_compare <span class="ot">=</span> <span class="fu">hellinger</span>(theta_df, doc, <span class="at">prob1 =</span> theta,</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">topicsdf2 =</span> gamma_df, </span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">id2 =</span> document, </span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">prob2 =</span> gamma_rn, <span class="at">df =</span> <span class="cn">TRUE</span>)</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>doc_compare <span class="sc">|&gt;</span> </span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(doc <span class="sc">==</span> document) <span class="sc">|&gt;</span> </span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(dist) <span class="sc">|&gt;</span> </span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
0.04808 0.10195 0.12378 0.12518 0.14564 0.24868 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(doc_compare, </span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="fu">as.integer</span>(doc), </span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">as.integer</span>(document), </span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="dv">1</span> <span class="sc">-</span> dist)) <span class="sc">+</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_raster</span>() <span class="sc">+</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_discrete</span>(<span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">name =</span> <span class="st">'true'</span>) <span class="sc">+</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_discrete</span>(<span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">name =</span> <span class="st">'fitted'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="paper_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>STM has a slightly closer fit, with a mean Hellinger distance of 0.08.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>fitted_stm_gamma <span class="ot">=</span> <span class="fu">tidy</span>(fitted_stm, <span class="at">matrix =</span> <span class="st">'gamma'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">build_matrix</span>(document, topic, gamma, <span class="at">sparse =</span> <span class="cn">FALSE</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hellinger</span>(theta, fitted_stm_gamma <span class="sc">%*%</span> <span class="fu">t</span>(rotation_stm)) <span class="sc">|&gt;</span> </span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">diag</span>() <span class="sc">|&gt;</span> </span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
0.03216 0.07148 0.08638 0.08823 0.10260 0.19884 </code></pre>
</div>
</div>
</section>
</section>
<section id="sec-realbooks" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Example 2: Literature from the long nineteenth century</h1>
<p>Our second example will analyze a literary corpus from the long nineteenth century, attempting to recover the author of each document. In order to reduce the number of requests sent to Project Gutenberg, we construct a convenience function to identify and retrieve fulltext works given an author’s Gutenberg ID, and wrap this in <code>memoise::memoise()</code> to create a local cache.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)            <span class="co"># infrastructure</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>())</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggbeeswarm)</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(memoise)</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tictoc)</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gutenbergr)           <span class="co"># text retrieval and manipulation</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytext)</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmfast)               <span class="co"># topic modeling</span></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stm)                  <span class="co"># topic modeling</span></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>get_author <span class="ot">=</span> <span class="cf">function</span>(author_id) {</span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gutenberg_works</span>(gutenberg_author_id <span class="sc">==</span> author_id, </span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>                    has_text) <span class="sc">|&gt;</span> </span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">gutenberg_download</span>(<span class="at">meta_fields =</span> <span class="fu">c</span>(<span class="st">'author'</span>, <span class="st">'title'</span>), </span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>                           <span class="at">mirror =</span> <span class="st">'http://aleph.gutenberg.org'</span>)</span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a>get_author <span class="ot">=</span> <span class="fu">memoise</span>(get_author, </span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a>                     <span class="at">cache =</span> <span class="fu">cache_filesystem</span>(<span class="st">'realbooks'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="corpus-assembly" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="corpus-assembly"><span class="header-section-number">4.1</span> Corpus assembly</h2>
<p>We first retrieve all works in Project Gutenberg by our target authors: Jane Austen, Charlotte and Emily Brontë, Louisa May Alcott, George Eliot, Charles Dickens, HG Wells, and HP Lovecraft. For these authors, the <code>memoise</code> local cache ends up at about 286 MB.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Jane Austen is author 68</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="co"># gutenberg_authors |&gt; </span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="co">#     filter(str_detect(author, 'Austen'))</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>austen_df <span class="ot">=</span> <span class="fu">get_author</span>(<span class="dv">68</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Anne Brontë is 404</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="co"># filter(gutenberg_authors, str_detect(author, 'Brontë'))</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>a_bronte_df <span class="ot">=</span> <span class="fu">get_author</span>(<span class="dv">404</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Charlotte Brontë is 408</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="co"># filter(gutenberg_authors, str_detect(author, 'Brontë'))</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>c_bronte_df <span class="ot">=</span> <span class="fu">get_author</span>(<span class="dv">408</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Emily Brontë is 405</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="co"># filter(gutenberg_authors, str_detect(author, 'Brontë'))</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>e_bronte_df <span class="ot">=</span> <span class="fu">get_author</span>(<span class="dv">405</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Louisa May Alcott is 102</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="co"># filter(gutenberg_authors, str_detect(author, 'Alcott'))</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>alcott_df <span class="ot">=</span> <span class="fu">get_author</span>(<span class="dv">102</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="do">## George Eliot is 90</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="co"># filter(gutenberg_authors, str_detect(author, 'Eliot'))</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>eliot_df <span class="ot">=</span> <span class="fu">get_author</span>(<span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Mary Wollstonecraft Shelley is 61</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="co"># filter(gutenberg_authors, str_detect(author, 'Shelley'))</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>shelley_df <span class="ot">=</span> <span class="fu">get_author</span>(<span class="dv">61</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Charles Dickens is 37</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="co"># filter(gutenberg_authors, str_detect(author, 'Dickens'))</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>dickens_df <span class="ot">=</span> <span class="fu">get_author</span>(<span class="dv">37</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="do">## HG Wells is 30</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="co"># filter(gutenberg_authors, str_detect(author, 'Wells'))</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>wells_df <span class="ot">=</span> <span class="fu">get_author</span>(<span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="do">## HP Lovecraft is 34724</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="co"># filter(gutenberg_authors, str_detect(author, 'Lovecraft'))</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>lovecraft_df <span class="ot">=</span> <span class="fu">get_author</span>(<span class="dv">34724</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We combine these results, and use <code>tidytext::unnest_tokens()</code> to convert the result into a long-format document-term matrix. Note that token extraction can take a long moment. We also construct a dataframe to link titles to authors in the topic model output.</p>
<div class="cell" data-hash="paper_cache/html/unnamed-chunk-39_a6075ac1c7e06b396486f6e25c314c10">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>dataf <span class="ot">=</span> <span class="fu">bind_rows</span>(austen_df, </span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>                  a_bronte_df, </span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>                  c_bronte_df, </span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>                  e_bronte_df, </span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>                  alcott_df, </span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>                  eliot_df,</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>                  shelley_df,</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>                  dickens_df, </span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>                  wells_df, </span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>                  lovecraft_df) <span class="sc">|&gt;</span> </span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest_tokens</span>(term, text, <span class="at">token =</span> <span class="st">'words'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(gutenberg_id, author, title, term)</span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>dataf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,812,904 × 5
   gutenberg_id author                        title            term            n
          &lt;int&gt; &lt;chr&gt;                         &lt;chr&gt;            &lt;chr&gt;       &lt;int&gt;
 1           35 Wells, H. G. (Herbert George) The Time Machine _can_           1
 2           35 Wells, H. G. (Herbert George) The Time Machine _cancan_        1
 3           35 Wells, H. G. (Herbert George) The Time Machine _down_          1
 4           35 Wells, H. G. (Herbert George) The Time Machine _four_          1
 5           35 Wells, H. G. (Herbert George) The Time Machine _him_           1
 6           35 Wells, H. G. (Herbert George) The Time Machine _how_           1
 7           35 Wells, H. G. (Herbert George) The Time Machine _i_             1
 8           35 Wells, H. G. (Herbert George) The Time Machine _instantan…     1
 9           35 Wells, H. G. (Herbert George) The Time Machine _minus_         1
10           35 Wells, H. G. (Herbert George) The Time Machine _nil_           1
# … with 1,812,894 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>meta_df <span class="ot">=</span> <span class="fu">distinct</span>(dataf, author, title)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The number of works by each author varies widely, as does the total token count.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">distinct</span>(dataf, author, title) <span class="sc">|&gt;</span> </span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(author)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 2
   author                                 n
   &lt;chr&gt;                              &lt;int&gt;
 1 Alcott, Louisa May                    45
 2 Austen, Jane                          10
 3 Brontë, Anne                           2
 4 Brontë, Charlotte                      6
 5 Brontë, Emily                          1
 6 Dickens, Charles                      77
 7 Eliot, George                         18
 8 Lovecraft, H. P. (Howard Phillips)     7
 9 Shelley, Mary Wollstonecraft          17
10 Wells, H. G. (Herbert George)         70</code></pre>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(dataf, <span class="fu">n_distinct</span>(author, title))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 253</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>dataf <span class="sc">|&gt;</span> </span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(author, title) <span class="sc">|&gt;</span> </span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">sum</span>(n)) <span class="sc">|&gt;</span> </span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">min =</span> <span class="fu">min</span>(n), </span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">median =</span> <span class="fu">median</span>(n), </span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">max =</span> <span class="fu">max</span>(n), </span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">total =</span> <span class="fu">sum</span>(n)) <span class="sc">|&gt;</span> </span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(total))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'author'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
   author                                min  median    max   total
   &lt;chr&gt;                               &lt;int&gt;   &lt;dbl&gt;  &lt;int&gt;   &lt;int&gt;
 1 Dickens, Charles                     1364  31226  360502 6785632
 2 Wells, H. G. (Herbert George)        3958  64936. 470557 5224147
 3 Alcott, Louisa May                   2660  55483  194549 2977676
 4 Eliot, George                        1871 108236. 320413 2247001
 5 Austen, Jane                        23192 101879  784790 1652092
 6 Shelley, Mary Wollstonecraft        12514  53643  183856 1434844
 7 Brontë, Charlotte                    1416 138921  219783  699938
 8 Brontë, Anne                        68716 119946. 171177  239893
 9 Lovecraft, H. P. (Howard Phillips)   3654  12073   99008  160200
10 Brontë, Emily                      117082 117082  117082  117082</code></pre>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>dataf <span class="sc">|&gt;</span> </span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(author, title) <span class="sc">|&gt;</span> </span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">sum</span>(n)) <span class="sc">|&gt;</span> </span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(author, n, <span class="at">color =</span> author)) <span class="sc">+</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_beeswarm</span>() <span class="sc">+</span></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>(<span class="at">guide =</span> <span class="st">'none'</span>) <span class="sc">+</span></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'author'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="paper_files/figure-html/unnamed-chunk-41-1.png" style="width:6in;height:4in"></p>
</div>
</div>
</section>
<section id="vocabulary-selection" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="vocabulary-selection"><span class="header-section-number">4.2</span> Vocabulary selection</h2>
<p>In line with a common rule of thumb in topic modeling, we aim for a vocabulary of about 10 times as many terms as documents in the corpus.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>vocab_size <span class="ot">=</span> <span class="fu">n_distinct</span>(dataf<span class="sc">$</span>author, dataf<span class="sc">$</span>title) <span class="sc">*</span> <span class="dv">10</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>vocab_size</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2530</code></pre>
</div>
</div>
<p><code>tmfast</code> provides two information-theoretic methods for vocabulary selection. Both are based on the idea of a two-player guessing game. I pick one of the documents from the corpus, then one of the terms from the document. I tell you the term, and you have to guess which document I picked. More informative terms have greater information gain (calculated as the Kullback-Leibler divergence) relative to a “baseline” distribution based purely on the process used to pick the document. The difference between the two methods is in the document-picking process. The <code>ndH</code> method assumes the document was picked uniformly at random from the corpus, so that no document is more likely to be picked than any other. The <code>ndR</code> method assumes document probability is proportional to the document length, so that shorter documents are less likely to be picked. This method implies that terms that are distinctive of shorter documents have high information gain, since they indicate “surprising” short documents.</p>
<p>On either method, the most informative terms are often typographical or OCR errors, since these only occur in a single document. To balance this, we multiply the information gain (<span class="math inline">\(\Delta H\)</span> for the uniform process, <span class="math inline">\(\Delta R\)</span> for the length-weighted process) by the log frequency of the term across the entire corpus (<span class="math inline">\(\log n\)</span>). So <code>ndH</code> is shorthand for <span class="math inline">\(\log(n) \Delta H\)</span> while <code>ndR</code> is shorthand for <span class="math inline">\(\log(n) \Delta R\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tic</span>()</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>H_df <span class="ot">=</span> <span class="fu">ndH</span>(dataf, title, term, n)</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>R_df <span class="ot">=</span> <span class="fu">ndR</span>(dataf, title, term, n) <span class="sc">|&gt;</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">in_vocab =</span> <span class="fu">rank</span>(<span class="fu">desc</span>(ndR)) <span class="sc">&lt;=</span> vocab_size)</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a><span class="fu">toc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>17.563 sec elapsed</code></pre>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>H_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 116,449 × 5
   term           H    dH     n   ndH
   &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;
 1 kipps     0.125   7.86  1454  82.6
 2 dombey    0.386   7.60  1618  81.0
 3 boffin    0.108   7.87  1127  79.8
 4 pecksniff 0.366   7.62  1320  79.0
 5 gwendolen 0.239   7.74  1048  77.7
 6 lydgate   0.0235  7.96   867  77.7
 7 deronda   0.404   7.58  1155  77.1
 8 nicholas  0.977   7.01  1931  76.5
 9 tito      0.0835  7.90   811  76.3
10 squeers   0.253   7.73   895  75.8
# … with 116,439 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>R_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 116,449 × 5
   term           n    dR   ndR in_vocab
   &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;lgl&gt;   
 1 kipps       1454  7.48  78.6 TRUE    
 2 hoopdriver   469  8.50  75.4 TRUE    
 3 scrooge     1007  7.54  75.3 TRUE    
 4 lewisham     575  8.03  73.6 TRUE    
 5 benham       689  7.56  71.3 TRUE    
 6 melville     243  8.97  71.1 TRUE    
 7 bealby       458  8.04  71.0 TRUE    
 8 veronica     659  7.52  70.4 TRUE    
 9 bert         556  7.71  70.3 TRUE    
10 christie    1797  6.43  69.5 TRUE    
# … with 116,439 more rows</code></pre>
</div>
</div>
<p>The resulting term ranking of the two methods tend to be similar, but <code>ndR</code> is preferable in the current case because of the additional weight it gives to distinctive terms from shorter documents.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(H_df, R_df, <span class="at">by =</span> <span class="st">'term'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(ndH, ndR, <span class="at">color =</span> in_vocab)) <span class="sc">+</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">alpha =</span> <span class="fu">rank</span>(<span class="fu">desc</span>(ndH)) <span class="sc">&lt;=</span> vocab_size))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using alpha for a discrete variable is not advised.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="paper_files/figure-html/unnamed-chunk-44-1.png" style="width:6in;height:4in"></p>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inner_join</span>(H_df, R_df, <span class="at">by =</span> <span class="st">'term'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">ndH_rank =</span> <span class="fu">rank</span>(<span class="fu">desc</span>(ndH)), </span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">ndR_rank =</span> <span class="fu">rank</span>(<span class="fu">desc</span>(ndR))) <span class="sc">|&gt;</span> </span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(ndH_rank, ndR_rank, <span class="at">color =</span> in_vocab)) <span class="sc">+</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">alpha =</span> ndH_rank <span class="sc">&lt;=</span> vocab_size)) <span class="sc">+</span></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_log10</span>() <span class="sc">+</span> </span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_log10</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using alpha for a discrete variable is not advised.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="paper_files/figure-html/unnamed-chunk-44-2.png" style="width:6in;height:4in"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>vocab <span class="ot">=</span> R_df <span class="sc">|&gt;</span> </span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(in_vocab) <span class="sc">|&gt;</span> </span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(term)</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(vocab, <span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "kipps"      "hoopdriver" "scrooge"    "lewisham"   "benham"    
 [6] "melville"   "bealby"     "veronica"   "bert"       "christie"  
[11] "sylvia"     "snitchey"   "boldheart"  "britling"   "castruccio"
[16] "bounderby"  "lillian"    "maggie"     "marjorie"   "craggs"    
[21] "n't"        "kemp"       "bab"        "redwood"    "harman"    
[26] "cavor"      "chatteris"  "brumley"    "ammi"       "heathcliff"
[31] "tackleton"  "gladys"     "helwyze"    "tetterby"   "montgomery"
[36] "lodore"     "trafford"   "treherne"   "jill"       "ludovico"  
[41] "tito"       "lomi"       "canaris"    "trotty"     "villiers"  
[46] "falkner"    "doubledick" "amanda"     "gradgrind"  "linton"    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>dataf <span class="sc">|&gt;</span> </span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(term <span class="sc">%in%</span> vocab) <span class="sc">|&gt;</span> </span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(author, title) <span class="sc">|&gt;</span> </span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">sum</span>(n)) <span class="sc">|&gt;</span> </span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(author, n, <span class="at">color =</span> author)) <span class="sc">+</span></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_beeswarm</span>() <span class="sc">+</span></span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>(<span class="at">guide =</span> <span class="st">'none'</span>) <span class="sc">+</span></span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'author'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="paper_files/figure-html/unnamed-chunk-46-1.png" style="width:6in;height:4in"></p>
</div>
</div>
</section>
<section id="fit-topic-models" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="fit-topic-models"><span class="header-section-number">4.3</span> Fit topic models</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>dtm <span class="ot">=</span> dataf <span class="sc">|&gt;</span> </span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(term <span class="sc">%in%</span> vocab) <span class="sc">|&gt;</span> </span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">n =</span> <span class="fu">log1p</span>(n))</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>n_authors <span class="ot">=</span> <span class="fu">n_distinct</span>(dataf<span class="sc">$</span>author)</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tic</span>()</span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>fitted_tmf <span class="ot">=</span> <span class="fu">tmfast</span>(dtm, <span class="at">n =</span> <span class="fu">c</span>(<span class="dv">5</span>,</span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>                               n_authors, </span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a>                               n_authors <span class="sc">+</span> <span class="dv">5</span>),</span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">row =</span> title, <span class="at">column =</span> term, <span class="at">value =</span> n)</span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a><span class="fu">toc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.754 sec elapsed</code></pre>
</div>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">screeplot</span>(fitted_tmf, <span class="at">npcs =</span> n_authors <span class="sc">+</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="paper_files/figure-html/unnamed-chunk-47-1.png" style="width:6in;height:4in"></p>
</div>
</div>
</section>
<section id="topic-exploration" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="topic-exploration"><span class="header-section-number">4.4</span> Topic exploration</h2>
<p>Without renormalization, most of the works are spread across a few topics, and the topics don’t clearly correspond to authors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(fitted_tmf, n_authors, <span class="st">'gamma'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(meta_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'document'</span> <span class="ot">=</span> <span class="st">'title'</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(document, gamma, <span class="at">fill =</span> topic)) <span class="sc">+</span></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(author), <span class="at">scales =</span> <span class="st">'free_x'</span>) <span class="sc">+</span></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="st">'none'</span>) <span class="sc">+</span></span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_viridis_d</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="paper_files/figure-html/unnamed-chunk-48-1.png" style="width:6in;height:4in"></p>
</div>
</div>
<p>To renormalize, we need to choose a theoretical Dirichlet distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">=</span> <span class="fu">peak_alpha</span>(n_authors, <span class="dv">1</span>, <span class="at">peak =</span> .<span class="dv">8</span>, <span class="at">scale =</span> <span class="dv">10</span>)</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>target_entropy <span class="ot">=</span> <span class="fu">expected_entropy</span>(alpha)</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>target_entropy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.997604</code></pre>
</div>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>exponent <span class="ot">=</span> <span class="fu">tidy</span>(fitted_tmf, n_authors, <span class="st">'gamma'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">target_power</span>(document, gamma, target_entropy)</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>exponent</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4.064884</code></pre>
</div>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(fitted_tmf, n_authors, <span class="st">'gamma'</span>, <span class="at">exponent =</span> exponent) <span class="sc">|&gt;</span> </span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(meta_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'document'</span> <span class="ot">=</span> <span class="st">'title'</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(document, gamma, <span class="at">fill =</span> topic)) <span class="sc">+</span></span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(author), <span class="at">scales =</span> <span class="st">'free_x'</span>) <span class="sc">+</span></span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="st">'none'</span>) <span class="sc">+</span></span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_viridis_d</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="paper_files/figure-html/unnamed-chunk-49-1.png" style="width:6in;height:4in"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(fitted_tmf, n_authors, <span class="st">'gamma'</span>, <span class="at">exponent =</span> exponent) <span class="sc">|&gt;</span> </span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(meta_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'document'</span> <span class="ot">=</span> <span class="st">'title'</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(document, topic, <span class="at">fill =</span> gamma)) <span class="sc">+</span></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_raster</span>() <span class="sc">+</span></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(<span class="fu">str_wrap</span>(author, </span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">width =</span> <span class="dv">20</span>)), </span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">scales =</span> <span class="st">'free_x'</span>, </span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">switch =</span> <span class="st">'x'</span>) <span class="sc">+</span></span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="st">'none'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="paper_files/figure-html/unnamed-chunk-50-1.png" style="width:6in;height:4in"></p>
</div>
</div>
<p>After renormalization, there are distinctive topics for Alcott (4) and Wells (1 and 9). Austen, Anne Brontë, Emily Brontë, and some of Shelley’s works appear together in topic 3. Charlotte Brontë and some of Eliot’s and Shelley’s works split topic 5. Eliot and Lovecraft share topic 10. And Dickens’ works are spread across multiple topics, with 2, 6, and 8 appearing to be distinctive to him.</p>
<p>To aid interpretation, we create a crosswalk dataframe connecting topics to authors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>topic_author <span class="ot">=</span> <span class="fu">tribble</span>(</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span> topic, <span class="sc">~</span> authors,</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'V01'</span>, <span class="st">'Wells'</span>, </span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'V02'</span>, <span class="st">'Dickens'</span>, </span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'V03'</span>, <span class="st">'Austin, A &amp; E Brontë'</span>, </span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'V04'</span>, <span class="st">'Alcott'</span>, </span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'V05'</span>, <span class="st">'Dickens'</span>, </span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'V06'</span>, <span class="st">'Dickens'</span>, </span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'V07'</span>, <span class="st">'C Brontë, Eliot, Shelley'</span>, </span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'V08'</span>, <span class="st">'Dickens'</span>, </span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'V09'</span>, <span class="st">'Wells'</span>, </span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'V10'</span>, <span class="st">'Eliot, Lovecraft'</span></span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To explore these topics further, we turn to the word-topic distribution. These distributions could be renormalized, as with the topic-doc distributions. But the exponent for the word-topic distributions is usually quite close to 1, meaning renormalization doesn’t change these distributions very much.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>target_entropy_term <span class="ot">=</span> <span class="fu">expected_entropy</span>(.<span class="dv">1</span>, <span class="at">k =</span> vocab_size)</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>target_entropy_term</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8.597192</code></pre>
</div>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>exponent_term <span class="ot">=</span> <span class="fu">tidy</span>(fitted_tmf, n_authors, <span class="st">'beta'</span>) <span class="sc">|&gt;</span> </span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">target_power</span>(topic, beta, target_entropy_term)</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>exponent_term</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.066448</code></pre>
</div>
</div>
<p>We therefore skip renormalization and move directly to a Silge plot, showing the top 10 terms for each topic. <code>tidytext::reorder_within()</code> and <code>tidytext::scale_x_reordered()</code> are useful for constructing this plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>beta_df <span class="ot">=</span> <span class="fu">tidy</span>(fitted_tmf, n_authors, <span class="st">'beta'</span>)</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>top_terms <span class="ot">=</span> beta_df <span class="sc">|&gt;</span> </span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(topic) <span class="sc">|&gt;</span> </span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(topic, <span class="fu">desc</span>(beta)) <span class="sc">|&gt;</span> </span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">top_n</span>(<span class="dv">15</span>, beta) <span class="sc">|&gt;</span> </span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(topic_author, <span class="at">by =</span> <span class="st">'topic'</span>)</span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>top_terms</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 150 × 4
# Groups:   topic [10]
   token     topic    beta authors
   &lt;chr&gt;     &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;  
 1 empire    V01   0.0162  Wells  
 2 britain   V01   0.0124  Wells  
 3 peoples   V01   0.0122  Wells  
 4 russia    V01   0.0117  Wells  
 5 king      V01   0.0111  Wells  
 6 asia      V01   0.0104  Wells  
 7 socialism V01   0.00995 Wells  
 8 section   V01   0.00971 Wells  
 9 egypt     V01   0.00926 Wells  
10 ii        V01   0.00892 Wells  
# … with 140 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>top_terms <span class="sc">|&gt;</span> </span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">token =</span> <span class="fu">reorder_within</span>(token, </span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">by =</span> beta, </span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">within =</span> topic)) <span class="sc">|&gt;</span> </span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(token, beta)) <span class="sc">+</span></span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> token), <span class="at">yend =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(topic, authors), <span class="at">scales =</span> <span class="st">'free_y'</span>) <span class="sc">+</span></span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_reordered</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><embed src="paper_files/figure-html/unnamed-chunk-53-1.pdf" style="width:6in;height:4in"></p>
</div>
</div>
<p>Most topics (2, 3, 4, 5, 6, 8, 9) focus on character names, with three of the four Dickens topics corresponding to <em>The Pickwick Papers</em> (topic 2), <em>Oliver Twist</em> (5), and <em>David Copperfield</em> (8). Wells’ topics appear to distinguish non-fiction essays (topic 1) from fiction (9). Topic 7 groups together Charlotte Brontë, Eliot, and Shelley based on the use of French. Topic 10 has a mix of character names with months of the year; it appears to be a “miscellaneous” topic, often created by topic models to accommodate documents that don’t fit elsewhere.</p>
</section>
</section>
<section id="reproducibility" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Reproducibility</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>sessioninfo<span class="sc">::</span><span class="fu">session_info</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>─ Session info ───────────────────────────────────────────────────────────────
 setting  value
 version  R version 4.1.2 (2021-11-01)
 os       macOS Big Sur 10.16
 system   x86_64, darwin17.0
 ui       X11
 language (EN)
 collate  en_US.UTF-8
 ctype    en_US.UTF-8
 tz       America/Los_Angeles
 date     2023-05-02
 pandoc   2.16.2 @ /usr/local/bin/ (via rmarkdown)

─ Packages ───────────────────────────────────────────────────────────────────
 package     * version          date (UTC) lib source
 assertthat    0.2.1            2019-03-21 [1] CRAN (R 4.1.0)
 backports     1.4.1            2021-12-13 [1] CRAN (R 4.1.0)
 beeswarm      0.4.0            2021-06-01 [1] CRAN (R 4.1.0)
 broom         1.0.2            2022-12-15 [1] CRAN (R 4.1.2)
 cachem        1.0.7            2023-02-24 [1] CRAN (R 4.1.2)
 cellranger    1.1.0            2016-07-27 [1] CRAN (R 4.1.0)
 cli           3.6.0            2023-01-09 [1] CRAN (R 4.1.2)
 colorspace    2.0-3            2022-02-21 [1] CRAN (R 4.1.2)
 crayon        1.5.1            2022-03-26 [1] CRAN (R 4.1.2)
 data.table    1.14.2           2021-09-27 [1] CRAN (R 4.1.0)
 DBI           1.1.2            2021-12-20 [1] CRAN (R 4.1.0)
 dbplyr        2.2.1            2022-06-27 [1] CRAN (R 4.1.2)
 digest        0.6.31           2022-12-11 [1] CRAN (R 4.1.2)
 dplyr       * 1.0.10           2022-09-01 [1] CRAN (R 4.1.2)
 ellipsis      0.3.2            2021-04-29 [1] CRAN (R 4.1.0)
 evaluate      0.20             2023-01-17 [1] CRAN (R 4.1.2)
 fansi         1.0.3            2022-03-24 [1] CRAN (R 4.1.2)
 farver        2.1.1            2022-07-06 [1] CRAN (R 4.1.2)
 fastmap       1.1.1            2023-02-24 [1] CRAN (R 4.1.2)
 forcats     * 0.5.2            2022-08-19 [1] CRAN (R 4.1.2)
 fs            1.6.1            2023-02-06 [1] CRAN (R 4.1.2)
 generics      0.1.3            2022-07-05 [1] CRAN (R 4.1.2)
 ggbeeswarm  * 0.6.0            2017-08-07 [1] CRAN (R 4.1.0)
 ggplot2     * 3.4.0            2022-11-04 [1] CRAN (R 4.1.2)
 glue        * 1.6.2            2022-02-24 [1] CRAN (R 4.1.2)
 gtable        0.3.0            2019-03-25 [1] CRAN (R 4.1.0)
 gutenbergr  * 0.2.3            2022-12-14 [1] CRAN (R 4.1.2)
 haven         2.5.1            2022-08-22 [1] CRAN (R 4.1.2)
 hms           1.1.2            2022-08-19 [1] CRAN (R 4.1.2)
 htmltools     0.5.4            2022-12-07 [1] CRAN (R 4.1.2)
 htmlwidgets   1.5.4            2021-09-08 [1] CRAN (R 4.1.0)
 httr          1.4.4            2022-08-17 [1] CRAN (R 4.1.2)
 irlba         2.3.5            2021-12-06 [1] CRAN (R 4.1.0)
 janeaustenr   0.1.5            2017-06-10 [1] CRAN (R 4.1.0)
 jsonlite      1.8.4            2022-12-06 [1] CRAN (R 4.1.2)
 knitr         1.42             2023-01-25 [1] CRAN (R 4.1.2)
 labeling      0.4.2            2020-10-20 [1] CRAN (R 4.1.0)
 lattice       0.20-45          2021-09-22 [1] CRAN (R 4.1.2)
 lifecycle     1.0.3            2022-10-07 [1] CRAN (R 4.1.2)
 lpSolve     * 5.6.15           2020-01-24 [1] CRAN (R 4.1.0)
 lubridate     1.9.0            2022-11-06 [1] CRAN (R 4.1.2)
 magrittr      2.0.3            2022-03-30 [1] CRAN (R 4.1.2)
 Matrix        1.3-4            2021-06-01 [1] CRAN (R 4.1.2)
 memoise     * 2.0.1            2021-11-26 [1] CRAN (R 4.1.0)
 mnormt        2.0.2            2020-09-01 [1] CRAN (R 4.1.0)
 modelr        0.1.10           2022-11-11 [1] CRAN (R 4.1.2)
 munsell       0.5.0            2018-06-12 [1] CRAN (R 4.1.0)
 nlme          3.1-153          2021-09-07 [1] CRAN (R 4.1.2)
 pillar        1.8.1            2022-08-19 [1] CRAN (R 4.1.2)
 pkgconfig     2.0.3            2019-09-22 [1] CRAN (R 4.1.0)
 plyr          1.8.7            2022-03-24 [1] CRAN (R 4.1.2)
 psych         2.1.9            2021-09-22 [1] CRAN (R 4.1.0)
 purrr       * 1.0.0            2022-12-20 [1] CRAN (R 4.1.2)
 R6            2.5.1            2021-08-19 [1] CRAN (R 4.1.0)
 Rcpp          1.0.9            2022-07-08 [1] CRAN (R 4.1.2)
 readr       * 2.1.3            2022-10-01 [1] CRAN (R 4.1.2)
 readxl        1.4.1            2022-08-17 [1] CRAN (R 4.1.2)
 reprex        2.0.2            2022-08-17 [1] CRAN (R 4.1.2)
 reshape2      1.4.4            2020-04-09 [1] CRAN (R 4.1.0)
 rlang         1.1.0            2023-03-14 [1] CRAN (R 4.1.2)
 rmarkdown     2.14             2022-04-25 [1] CRAN (R 4.1.2)
 rstudioapi    0.13             2020-11-12 [1] CRAN (R 4.1.0)
 rvest         1.0.3            2022-08-19 [1] CRAN (R 4.1.2)
 scales        1.2.0            2022-04-13 [1] CRAN (R 4.1.2)
 sessioninfo   1.2.2            2021-12-06 [1] CRAN (R 4.1.0)
 SnowballC     0.7.0            2020-04-01 [1] CRAN (R 4.1.0)
 stm         * 1.3.6            2020-09-18 [1] CRAN (R 4.1.0)
 stringi       1.7.12           2023-01-11 [1] CRAN (R 4.1.2)
 stringr     * 1.5.0            2022-12-02 [1] CRAN (R 4.1.2)
 tibble      * 3.1.8            2022-07-22 [1] CRAN (R 4.1.2)
 tictoc      * 1.0.1            2021-04-19 [1] CRAN (R 4.1.0)
 tidyr       * 1.2.1            2022-09-08 [1] CRAN (R 4.1.2)
 tidyselect    1.1.2            2022-02-21 [1] CRAN (R 4.1.2)
 tidytext    * 0.3.2            2021-09-30 [1] CRAN (R 4.1.0)
 tidyverse   * 1.3.1            2021-04-15 [1] CRAN (R 4.1.0)
 timechange    0.1.1            2022-11-04 [1] CRAN (R 4.1.2)
 tmfast      * 0.0.0.2023-04-15 2023-04-15 [1] local
 tmvnsim       1.0-2            2016-12-15 [1] CRAN (R 4.1.0)
 tokenizers    0.2.1            2018-03-29 [1] CRAN (R 4.1.0)
 tzdb          0.3.0            2022-03-28 [1] CRAN (R 4.1.2)
 utf8          1.2.2            2021-07-24 [1] CRAN (R 4.1.0)
 vctrs         0.6.0            2023-03-16 [1] CRAN (R 4.1.2)
 vipor         0.4.5            2017-03-22 [1] CRAN (R 4.1.0)
 viridisLite   0.4.0            2021-04-13 [1] CRAN (R 4.1.0)
 withr         2.5.0            2022-03-03 [1] CRAN (R 4.1.2)
 xfun          0.37             2023-01-31 [1] CRAN (R 4.1.2)
 xml2          1.3.3            2021-11-30 [1] CRAN (R 4.1.0)
 yaml          2.3.7            2023-01-23 [1] CRAN (R 4.1.2)

 [1] /Library/Frameworks/R.framework/Versions/4.1/Resources/library

──────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
</section>
<section id="references" class="level1 unnumbered" data-number="6">


</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">6 References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-BaglamaAugmentedImplicitlyRestarted2005" class="csl-entry" role="doc-biblioentry">
Baglama, James, and Lothar Reichel. 2005. <span>“Augmented Implicitly Restarted Lanczos Bidiagonalization Methods.”</span> <em>SIAM Journal on Scientific Computing</em> 27 (1): 19–42. <a href="https://doi.org/10.1137/04060593X">https://doi.org/10.1137/04060593X</a>.
</div>
<div id="ref-BaglamaIrlbaFastTruncated2022" class="csl-entry" role="doc-biblioentry">
Baglama, Jim, Lothar Reichel, and B. W. Lewis. 2022. <span>“Irlba: Fast Truncated Singular Value Decomposition and Principal Components Analysis for Large Dense and Sparse Matrices.”</span> <a href="https://cran.r-project.org/web/packages/irlba/index.html">https://cran.r-project.org/web/packages/irlba/index.html</a>.
</div>
<div id="ref-BleiLatentDirichletAllocation2003" class="csl-entry" role="doc-biblioentry">
Blei, David M., Andrew Y. Ng, and Michael I. Jordan. 2003. <span>“Latent Dirichlet Allocation.”</span> <em>The Journal of Machine Learning Research</em> 3: 993–1022. <a href="http://dl.acm.org/citation.cfm?id=944937">http://dl.acm.org/citation.cfm?id=944937</a>.
</div>
<div id="ref-GelmanGardenForkingPaths2013" class="csl-entry" role="doc-biblioentry">
Gelman, Andrew, and Eric Loken. 2013. <span>“The Garden of Forking Paths: Why Multiple Comparisons Can Be a Problem, Even When There Is No <span>‘Fishing Expedition’</span> or <span>‘p-Hacking’</span> and the Research Hypothesis Was Posited Ahead of Time.”</span> <em>Downloaded January</em> 30: 2014. <a href="http://www.stat.columbia.edu/~gelman/research/unpublished/p_hacking.pdf">http://www.stat.columbia.edu/~gelman/research/unpublished/p_hacking.pdf</a>.
</div>
<div id="ref-HicksProductivityInterdisciplinaryImpacts2021" class="csl-entry" role="doc-biblioentry">
Hicks, Daniel J. 2021. <span>“Productivity and Interdisciplinary Impacts of Organized Research Units.”</span> <em>Quantitative Science Studies</em> 2 (3): 990–1022. <a href="https://doi.org/10.1162/qss_a_00150">https://doi.org/10.1162/qss_a_00150</a>.
</div>
<div id="ref-MalaterreEarlyDaysContemporary2022" class="csl-entry" role="doc-biblioentry">
Malaterre, Christophe, and Francis Lareau. 2022. <span>“The Early Days of Contemporary Philosophy of Science: Novel Insights from Machine Translation and Topic-Modeling of Non-Parallel Multilingual Corpora.”</span> <em>Synthese</em> 200 (3): 242. <a href="https://doi.org/10.1007/s11229-022-03722-x">https://doi.org/10.1007/s11229-022-03722-x</a>.
</div>
<div id="ref-RobertsStmPackageStructural2019" class="csl-entry" role="doc-biblioentry">
Roberts, Margaret E, Brandon M Stewart, and Dustin Tingley. 2019. <span>“Stm: An R Package for Structural Topic Models.”</span> <em>Journal of Statistical Software</em> 91 (October): 1–40. <a href="https://doi.org/10.18637/jss.v091.i02">https://doi.org/10.18637/jss.v091.i02</a>.
</div>
<div id="ref-RoheVintageFactorAnalysis2020" class="csl-entry" role="doc-biblioentry">
Rohe, Karl, and Muzhe Zeng. 2020. <span>“Vintage Factor Analysis with Varimax Performs Statistical Inference.”</span> arXiv. <a href="https://doi.org/10.48550/arXiv.2004.05387">https://doi.org/10.48550/arXiv.2004.05387</a>.
</div>
<div id="ref-SteegenIncreasingTransparencyMultiverse2016" class="csl-entry" role="doc-biblioentry">
Steegen, Sara, Francis Tuerlinckx, Andrew Gelman, and Wolf Vanpaemel. 2016. <span>“Increasing Transparency Through a Multiverse Analysis.”</span> <em>Perspectives on Psychological Science</em> 11 (5): 702–12. <a href="https://doi.org/10.1177/1745691616658637">https://doi.org/10.1177/1745691616658637</a>.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Strictly speaking, PCA and factor analysis are two different analytical tasks. Factor analysis models are typically fit by optimizing a maximum likelihood model, rather than an algebraic method like SVD. And the rotation introduced in the next sentence means that the new variables are not orthogonal/uncorrelated and are not ordered from greatest to least variance, which are key desiderata of PCA. Nonetheless, the approach to topic modeling proposed by <span class="citation" data-cites="RoheVintageFactorAnalysis2020">Rohe and Zeng (<a href="#ref-RoheVintageFactorAnalysis2020" role="doc-biblioref">2020</a>)</span> combines PCA with varimax.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Orthogonal matrices have the property that <span class="math inline">\(T^t = T^{-1}\)</span>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>The <span class="math inline">\(k\)</span>-component Dirichlet distribution is parameterized by a <span class="math inline">\(k\)</span>-component vector <span class="math inline">\(\mathbf{\alpha} = \alpha (n_1, \ldots, n_k)\)</span>, where <span class="math inline">\(\alpha\)</span> is a scalar and <span class="math inline">\(\sum_i n_i = 1\)</span>. Using this parameterization, the expected value for component <span class="math inline">\(i\)</span> is <span class="math inline">\(n_i\)</span> with variance <span class="math inline">\(\frac{n_i(1-n_i)}{\alpha + 1}\)</span>. So increasing the scaling factor <span class="math inline">\(\alpha\)</span> means samples from the Dirichlet distribution will be more likely to look like <span class="math inline">\((n_1, \ldots, n_k)\)</span>.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Since <span class="math inline">\(\log(0+1) = 0\)</span>, this transformation also preserves sparsity and does not introduce infinite values.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>For <span class="math inline">\(P\)</span>, each row corresponds to the elementwise square root of one distribution <span class="math inline">\(\sqrt p_i\)</span> and each column to one component <span class="math inline">\(x \in X\)</span>, i.e., a cell contains the value <span class="math inline">\(\sqrt{p_i(x)}\)</span>. <span class="math inline">\(Q\)</span> is the transpose, with each row corresponding to one component <span class="math inline">\(x \in X\)</span> and each column corresponding to the square root of a distribution <span class="math inline">\(\sqrt q_j\)</span>. The product of these matrices is a <span class="math inline">\(i \times j\)</span> matrix with each cell the desired sum for <span class="math inline">\(p\)</span> and <span class="math inline">\(q\)</span>.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>